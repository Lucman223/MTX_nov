<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MotoTX - Presentaci√≥n Maestra Definitiva</title>
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <!-- PrismJS para resaltado de c√≥digo -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #059669;
            --accent: #facc15;
            --dark-bg: #0f172a;
            --panel-bg: #1e293b;
            --code-bg: #011627;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        body {
            font-family: 'Outfit', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--dark-bg);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* Layout Principal */
        .master-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        /* Panel de Diapositivas (Izquierda) */
        .content-panel {
            flex: 1.2;
            display: flex;
            flex-direction: column;
            padding: 40px;
            position: relative;
            z-index: 10;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1e1b4b 100%);
            overflow-y: auto;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Panel de C√≥digo (Derecha) */
        .code-panel {
            flex: 0.8;
            background-color: var(--code-bg);
            display: flex;
            flex-direction: column;
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.5);
            transition: var(--transition);
            transform: translateX(100%);
            opacity: 0;
            width: 0;
        }

        .code-panel.active {
            transform: translateX(0);
            opacity: 1;
            width: auto;
        }

        .code-header {
            padding: 12px 24px;
            background-color: #010e1a;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent);
        }

        .code-content {
            flex: 1;
            overflow: auto;
            margin: 0;
            font-size: 14px;
        }

        /* Bloques de Diapositiva */
        .slide {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            height: 100%;
            animation: slideIn 0.6s var(--transition);
        }

        .slide.active {
            display: flex;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Tipograf√≠a y Estilo */
        h1 {
            font-size: 4rem;
            font-weight: 800;
            margin: 0;
            line-height: 1.1;
            background: linear-gradient(to right, #60a5fa, #34d399);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h2 {
            font-size: 2.5rem;
            color: var(--accent);
            margin: 0 0 10px 0;
        }

        h3 {
            font-size: 1.6rem;
            color: var(--text-main);
            margin: 0 0 15px 0;
            border-left: 4px solid var(--primary);
            padding-left: 15px;
        }

        p {
            font-size: 1.1rem;
            color: var(--text-dim);
            line-height: 1.6;
            max-width: 650px;
        }

        .badge-tech {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(37, 99, 235, 0.2);
            color: #93c5fd;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 15px;
            border: 1px solid rgba(37, 99, 235, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .img-container {
            width: 100%;
            max-width: 650px;
            margin-top: 25px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .img-container img {
            width: 100%;
            display: block;
        }

        /* Navegaci√≥n */
        .nav-controls {
            position: absolute;
            bottom: 30px;
            left: 40px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(15, 23, 42, 0.8);
            padding: 8px 20px;
            border-radius: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--text-main);
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
        }

        .nav-btn:hover {
            color: var(--primary);
            transform: scale(1.2);
        }

        .nav-btn:disabled {
            color: #444;
            cursor: not-allowed;
        }

        .slide-indicator {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-dim);
            min-width: 60px;
            text-align: center;
        }

        .code-toggle {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .code-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(37, 99, 235, 0.3);
        }

        /* COMPONENTES AVANZADOS */
        .grid-tech {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            width: 100%;
            margin-top: 15px;
        }

        .tech-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 12px;
            border-top: 3px solid var(--primary);
            transition: var(--transition);
        }

        .tech-card h4 {
            margin: 0 0 8px 0;
            color: var(--accent);
            font-size: 1rem;
        }

        .tech-card ul {
            margin: 0;
            padding-left: 15px;
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .file-tree {
            font-family: 'JetBrains Mono', monospace;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.8rem;
            line-height: 1.4;
            width: 100%;
            border-left: 4px solid var(--secondary);
            margin: 15px 0;
        }

        .tree-folder {
            color: #facc15;
            font-weight: 600;
        }

        .tree-file {
            color: #94a3b8;
        }

        .tree-comment {
            color: #64748b;
            font-style: italic;
            margin-left: 10px;
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin: 20px 0;
            width: 100%;
        }

        .flow-node {
            background: var(--panel-bg);
            padding: 10px 18px;
            border-radius: 50px;
            border: 1px solid var(--primary);
            font-weight: 600;
            font-size: 0.85rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .flow-arrow {
            color: var(--text-dim);
            font-weight: bold;
        }

        .explanation-box {
            background: rgba(37, 99, 235, 0.08);
            border-left: 4px solid var(--primary);
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin-top: 20px;
            font-size: 0.95rem;
            color: #d1d5db;
        }

        .section-divider {
            width: 80px;
            height: 4px;
            background: var(--accent);
            margin: 20px 0;
            border-radius: 2px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            margin-top: 15px;
        }

        .gallery-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 160px;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .gallery-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.85));
            padding: 8px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* LIGHTBOX SYSTEM */
        .lightbox-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            cursor: zoom-out;
            animation: fadeIn 0.3s ease;
        }

        .lightbox-overlay.active {
            display: flex;
        }

        .lightbox-img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 15px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        pre[class*="language-"] {
            margin: 0 !important;
            border-radius: 0 !important;
            background: transparent !important;
        }
    </style>
</head>

<body>

    <div class="master-container">

        <!-- PANEL DE CONTENIDO -->
        <div class="content-panel">

            <!-- SECCI√ìN 1: INTRODUCCI√ìN Y VISI√ìN -->
            <div class="slide active" data-code="">
                <div class="badge-tech">URBAN MOBILITY MALI</div>
                <h1>MotoTX</h1>
                <h3>La Revoluci√≥n del Transporte en Bamako</h3>
                <div class="section-divider"></div>
                <p>MotoTX no es solo una aplicaci√≥n; es una <strong>infraestructura digital</strong> dise√±ada para
                    profesionalizar el sector del transporte informal en Mali.</p>
                <div class="img-container">
                    <img src="general_home.png" alt="MotoTX Mockup" class="zoomable">
                </div>
            </div>

            <div class="slide" data-code="">
                <h2>La Misi√≥n</h2>
                <h3>Digitalizaci√≥n con Impacto Social</h3>
                <div class="grid-tech">
                    <div class="tech-card">
                        <h4>Seguridad 100%</h4>
                        <ul>
                            <li>Identificaci√≥n KYC de motoristas.</li>
                            <li>Trazabilidad GPS en tiempo real.</li>
                            <li>Bot√≥n de p√°nico integrado.</li>
                        </ul>
                    </div>
                    <div class="tech-card">
                        <h4>Econom√≠a Digital</h4>
                        <ul>
                            <li>Integraci√≥n Orange Money Mali.</li>
                            <li>Sistema de Forfaits prepago.</li>
                            <li>Billeteras digitales seguras.</li>
                        </ul>
                    </div>
                </div>
                <div class="explanation-box">
                    <strong>Contexto:</strong> Bamako depende de las motocicletas para el 80% de sus desplazamientos.
                    MotoTX aporta orden, seguridad y modernidad a este ecosistema.
                </div>
            </div>

            <!-- SECCI√ìN 2: ARQUITECTURA GLOBAL -->
            <div class="slide" data-code="code-arch-global">
                <div class="badge-tech">SYSTEM DESIGN</div>
                <h2>Arquitectura de Sistema</h2>
                <h3>Monolito Moderno con UI At√≥mica</h3>
                <p>Implementamos un enfoque de <strong>Monolito Moderno</strong>: backend robusto en Laravel integrado
                    con una arquitectura <strong>Frontend At√≥mica</strong> en React.</p>
                <div class="file-tree">
                    <span class="tree-folder">/backend</span> <span class="tree-comment">// N√∫cleo de la
                        plataforma</span><br>
                    &nbsp;&nbsp;‚îú‚îÄ‚îÄ <span class="tree-folder">app/</span> <span class="tree-comment">// L√≥gica de
                        Negocio y Servicios</span><br>
                    &nbsp;&nbsp;‚îú‚îÄ‚îÄ <span class="tree-folder">resources/js/</span> <span class="tree-comment">// ‚öõÔ∏è UI
                        basada en √Åtomos/Mol√©culas</span><br>
                    &nbsp;&nbsp;‚îú‚îÄ‚îÄ <span class="tree-folder">routes/api/</span> <span class="tree-comment">// Endpoints
                        RESTful Protegidos</span><br>
                    &nbsp;&nbsp;‚îî‚îÄ‚îÄ <span class="tree-file">vite.config.js</span> <span class="tree-comment">// Motor de
                        empaquetado ultra-r√°pido</span>
                </div>
                <div class="explanation-box">
                    <strong>Evoluci√≥n:</strong> Hemos migrado de vistas r√≠gidas a un ecosistema de componentes
                    desacoplados, manteniendo la simplicidad operativa de un monorepo controlado por Vite.
                </div>
            </div>

            <div class="slide" data-code="code-frontend-structure">
                <div class="badge-tech">FRONTEND ECOSYSTEM</div>
                <h2>Estructura del Frontend</h2>
                <h3>Organizaci√≥n At√≥mica y Escalable</h3>
                <p>Ubicado dentro de <code>/backend/resources/js/</code>, nuestro frontend sigue un est√°ndar de
                    organizaci√≥n de alto nivel.</p>
                <div class="file-tree">
                    <span class="tree-folder">/js</span><br>
                    &nbsp;&nbsp;‚îú‚îÄ‚îÄ <span class="tree-folder">components/</span> <span class="tree-comment">// √Åtomos,
                        Mol√©culas y Organismos</span><br>
                    &nbsp;&nbsp;‚îú‚îÄ‚îÄ <span class="tree-folder">context/</span> <span class="tree-comment">// Gesti√≥n de
                        Estado Global (Auth)</span><br>
                    &nbsp;&nbsp;‚îú‚îÄ‚îÄ <span class="tree-folder">hooks/</span> <span class="tree-comment">// L√≥gica
                        Reutilizable (Geoloc, Notifs)</span><br>
                    &nbsp;&nbsp;‚îú‚îÄ‚îÄ <span class="tree-folder">pages/</span> <span class="tree-comment">// Vistas por
                        Roles (Cliente, Motorista, Admin)</span><br>
                    &nbsp;&nbsp;‚îî‚îÄ‚îÄ <span class="tree-file">App.jsx</span> <span class="tree-comment">// Orquestador de
                        Rutas Protegidas</span>
                </div>
                <div class="explanation-box">
                    Esta estructura permite que el frontend crezca de forma modular, permitiendo que m√∫ltiples
                    desarrolladores trabajen en diferentes roles sin conflictos de arquitectura.
                </div>
            </div>

            <!-- SECCI√ìN 3: BACKEND DEEP DIVE -->
            <div class="slide" data-code="code-service-layer">
                <div class="badge-tech">BACKEND MASTERY</div>
                <h2>Patr√≥n "Service Layer"</h2>
                <h3>Separaci√≥n de Responsabilidades</h3>
                <p>Nuestros controladores son "delgados"; la l√≥gica de negocio real reside en Servicios puros.</p>
                <div class="flow-diagram">
                    <div class="flow-node">Request (JSON)</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node">Controller</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node" style="border-color: var(--secondary);">Service Layer</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node">Eloquent Models</div>
                </div>
                <div class="grid-tech">
                    <div class="tech-card">
                        <h4>Mantenibilidad</h4>
                        <p>Cambios en reglas de negocio afectan solo al Servicio, no a la API.</p>
                    </div>
                    <div class="tech-card">
                        <h4>Transacciones</h4>
                        <p>Uso de <code>DB::transaction</code> para asegurar la atomicidad de los pagos.</p>
                    </div>
                </div>
            </div>

            <div class="slide" data-code="code-api-rest">
                <div class="badge-tech">BACKEND MASTERY</div>
                <h2>Excelencia en API REST</h2>
                <h3>Consistencia y Tipado</h3>
                <p>Toda la comunicaci√≥n entre React y Laravel sigue un est√°ndar estricto de respuestas JSON.</p>
                <div class="file-tree">
                    {<br>
                    &nbsp;&nbsp;"status": "success",<br>
                    &nbsp;&nbsp;"data": { ... },<br>
                    &nbsp;&nbsp;"message": "Operaci√≥n completada"<br>
                    }
                </div>
                <div class="explanation-box">
                    Usamos c√≥digos de estado HTTP sem√°nticos (201 Created, 403 Forbidden, 422 Unprocessable Content)
                    para una integraci√≥n robusta.
                </div>
            </div>

            <div class="slide" data-code="code-auth">
                <div class="badge-tech">SECURITY</div>
                <h2>Seguridad & JWT</h2>
                <h3>Autenticaci√≥n Stateless</h3>
                <p>Implementaci√≥n de <strong>JSON Web Tokens</strong> para una comunicaci√≥n segura y escalable entre UI
                    y Servidor.</p>
                <div class="flow-diagram">
                    <div class="flow-node">Login</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node" style="border-color: #facc15;">Server (Tymon JWT)</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node">Access Token (HS256)</div>
                </div>
                <div class="explanation-box">
                    - Middleware <code>jwt.auth</code> protege todas las rutas del cliente y motorista.<br>
                    - El token viaja en el Header <code>Authorization: Bearer</code>.<br>
                    - Eliminamos el estado de sesi√≥n en servidor para mayor performance.
                </div>
            </div>

            <div class="slide" data-code="code-frontend-routes">
                <div class="badge-tech">SECURITY</div>
                <h2>Control de Accesos (RBAC)</h2>
                <h3>Rutas Protegidas en UI</h3>
                <p>El cliente nunca puede ver el panel de administraci√≥n, y el motorista solo accede a su terminal de
                    trabajo.</p>
                <div class="file-tree">
                    &lt;ProtectedRoute role="admin"&gt;<br>
                    &nbsp;&nbsp;&lt;AdminDashboard /&gt;<br>
                    &lt;/ProtectedRoute&gt;
                </div>
                <div class="explanation-box">
                    Nuestra UI es inteligente: valida los "claims" del token antes de renderizar componentes cr√≠ticos,
                    duplicando la seguridad del backend.
                </div>
            </div>

            <!-- SECCI√ìN 4: BASE DE DATOS -->
            <div class="slide" data-code="code-db-models">
                <div class="badge-tech">DATABASE DESIGN</div>
                <h2>Modelo de Datos</h2>
                <h3>Integridad Relacional</h3>
                <div class="grid-tech">
                    <div class="tech-card">
                        <h4>Viajes (Trips)</h4>
                        <ul>
                            <li>Relaci√≥n <code>User-Client</code>.</li>
                            <li>Relaci√≥n <code>User-Driver</code>.</li>
                            <li>Estados: Solicitado, Aceptado, Finalizado.</li>
                        </ul>
                    </div>
                    <div class="tech-card">
                        <h4>Econom√≠a</h4>
                        <ul>
                            <li>Tabla <code>Forfaits</code> vinculada a cr√©ditos.</li>
                            <li>Historial de pagos immutable.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="slide" data-code="code-algorithm">
                <div class="badge-tech">BUSINESS LOGIC</div>
                <h2>Algoritmo de Tarifas</h2>
                <h3>Gobernanza de Precios</h3>
                <p>Sistema din√°mico de c√°lculo de costes basado en la pol√≠tica de Forfaits prepago.</p>
                <div class="flow-diagram">
                    <div class="flow-node">Solicitud</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node" style="border-color: #facc15;">Validar Saldo</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node">Descontar "Uso"</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node">Confirmar</div>
                </div>
                <div class="explanation-box">
                    El sistema asegura que ning√∫n viaje comience sin una transacci√≥n at√≥mica previa, protegiendo los
                    ingresos del motorista.
                </div>
            </div>

            <!-- SECCI√ìN 5: FRONTEND MASTERY -->
            <div class="slide" data-code="code-design-system">
                <div class="badge-tech">FRONTEND EXCELLENCE</div>
                <h2>Sistema de Dise√±o At√≥mico</h2>
                <h3>De Estilos Inline a Componentes Reutilizables</h3>
                <p>Hemos evolucionado de una estructura monol√≠tica visual a un <strong>Sistema At√≥mico</strong> basado
                    en componentes independientes.</p>
                <div class="grid-tech">
                    <div class="tech-card">
                        <h4>√Åtomos y Mol√©culas</h4>
                        <p>Componentes <code>Card</code>, <code>Button</code> y <code>Badge</code> que encapsulan l√≥gica
                            y estilo.</p>
                    </div>
                    <div class="tech-card">
                        <h4>Consistencia Global</h4>
                        <p>Un cambio en el √°tomo de color primario impacta positivamente en toda la plataforma.</p>
                    </div>
                </div>
            </div>

            <div class="slide" data-code="code-performance">
                <div class="badge-tech">FRONTEND EXCELLENCE</div>
                <h2>Performance en Redes 3G</h2>
                <h3>Optimizaci√≥n para Mali</h3>
                <p>Nuestra audiencia principal usa conexiones limitadas; optimizamos cada byte.</p>
                <div class="grid-tech">
                    <div class="tech-card">
                        <h4>Asset Bundling</h4>
                        <p>Vite + Terser para minificaci√≥n extrema.</p>
                    </div>
                    <div class="tech-card">
                        <h4>Lazy Loading</h4>
                        <p>Carga de componentes bajo demanda para reducir el TTI.</p>
                    </div>
                </div>
            </div>

            <div class="slide" data-code="code-ux-psych">
                <div class="badge-tech">FRONTEND EXCELLENCE</div>
                <h2>Psicolog√≠a UX</h2>
                <h3>Dise√±o "One-Hand"</h3>
                <p>En el caos de Bamako, la interfaz del motorista debe ser infalible y r√°pida.</p>
                <div class="grid-tech">
                    <div class="tech-card">
                        <h4>Ley de Fitts</h4>
                        <p>Botones cr√≠ticos en la zona de acci√≥n natural del pulgar.</p>
                    </div>
                    <div class="tech-card">
                        <h4>Feedback H√°ptico</h4>
                        <p>Micro-interacciones para confirmar acciones sin mirar la pantalla.</p>
                    </div>
                </div>
            </div>

            <div class="slide" data-code="code-frontend-context">
                <div class="badge-tech">REACT ENGINE</div>
                <h2>Gesti√≥n de Estado Global</h2>
                <h3>Context API & Auth Provider</h3>
                <p>Implementamos un proveedor centralizado para heredar el estado de autenticaci√≥n y datos de usuario
                    sin "prop drilling".</p>
                <div class="grid-tech">
                    <div class="tech-card">
                        <h4>AuthContext</h4>
                        <p>Mantiene el Token JWT y el objeto User reactivamente.</p>
                    </div>
                    <div class="tech-card">
                        <h4>Persistencia</h4>
                        <p>Sincronizaci√≥n autom√°tica con LocalStorage para sesiones persistentes.</p>
                    </div>
                </div>
            </div>

            <div class="slide" data-code="code-frontend-hooks">
                <div class="badge-tech">REACT ENGINE</div>
                <h2>L√≥gica Reutilizable</h2>
                <h3>Custom Hooks Pattern</h3>
                <p>Abstraemos la l√≥gica compleja de geolocalizaci√≥n y APIs en Hooks personalizados para un c√≥digo m√°s
                    limpio.</p>
                <div class="flow-diagram">
                    <div class="flow-node">UI Component</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node" style="border-color: var(--accent);">useGeolocation()</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node">Live Coords</div>
                </div>
            </div>

            <!-- SECCI√ìN 6: GALER√çA VISUAL - PLATAFORMA P√öBLICA -->
            <div class="slide" data-code="code-landing">
                <div class="badge-tech">PUBLIC VIEW</div>
                <h2>Plataforma P√∫blica</h2>
                <h3>Primeros Pasos del Usuario</h3>
                <p>Dise√±o enfocado en la conversi√≥n y la simplicidad (Landing & Registro).</p>
                <div class="gallery-grid">
                    <div class="gallery-item">
                        <img src="general_home.png" alt="Home">
                        <div class="gallery-caption">Landing Page SEO Ready</div>
                    </div>
                    <div class="gallery-item" data-code="code-register">
                        <img src="general_registro.png" alt="Registro">
                        <div class="gallery-caption">Registro de Roles Dual</div>
                    </div>
                </div>
                <div class="explanation-box">
                    El sistema detecta autom√°ticamente el rol para aplicar reglas de validaci√≥n espec√≠ficas en el
                    onboarding.
                </div>
            </div>

            <!-- SECCI√ìN 7: EXPERIENCIA DEL CLIENTE -->
            <div class="slide" data-code="code-client-dash">
                <div class="badge-tech">CLIENT EXPERIENCE</div>
                <h2>Dashboard & Geocodificaci√≥n</h2>
                <h3>Planificaci√≥n Inteligente</h3>
                <p>Interfaz reactiva con integraci√≥n de la API <strong>Nominatim</strong> para b√∫squeda de direcciones
                    en tiempo real.</p>
                <div class="img-container">
                    <img src="cliente_dashboard.png" alt="Dashboard Cliente">
                </div>
                <div class="explanation-box">
                    - <strong>B√∫squeda por Texto</strong>: Convertimos direcciones en coordenadas geogr√°ficas.<br>
                    - <strong>ETA din√°mico</strong>: C√°lculo de tiempo estimado (Haversine) antes de solicitar.<br>
                    - <strong>Validaci√≥n Visual</strong>: Los puntos se confirman con distintivos interactivos.
                </div>
            </div>

            <div class="slide" data-code="code-smart-mobility">
                <div class="badge-tech">SMART MOBILITY</div>
                <h2>Zonas y Restricciones</h2>
                <h3>Gobernanza Geogr√°fica</h3>
                <p>Implementamos un sistema de <strong>Validaci√≥n Proactiva</strong> basado en el rango de los Forfaits
                    contratados.</p>
                <div class="flow-diagram">
                    <div class="flow-node">Trayecto (km)</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node" style="border-color: #ef4444;">Validador de Rango</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node">Bloqueo / Solicitud</div>
                </div>
                <div class="explanation-box">
                    - <strong>Zonificaci√≥n</strong>: Diferenciamos entre Pack Urbano (5km) y Pack Transversale
                    (Ilimitado).<br>
                    - <strong>Seguridad Econ√≥mica</strong>: Evitamos el uso indebido de paquetes econ√≥micos en
                    distancias largas.<br>
                    - <strong>User Alerts</strong>: Feedback visual con animaciones de advertencia cuando se excede el
                    l√≠mite.
                </div>
            </div>

            <div class="slide" data-code="code-client-forfaits">
                <div class="badge-tech">CLIENT EXPERIENCE</div>
                <h2>Ecosistema de Pagos</h2>
                <h3>Forfaits & Gesti√≥n Financiera</h3>
                <p>Soluci√≥n innovadora al problema del cambio f√≠sico mediante cr√©ditos de viaje digitales.</p>
                <div class="gallery-grid">
                    <div class="gallery-item">
                        <img src="cliente_forfaits.png" alt="Forfaits">
                        <div class="gallery-caption">Cat√°logo de Planes</div>
                    </div>
                    <div class="gallery-item">
                        <img src="cliente_perfil.png" alt="Perfil">
                        <div class="gallery-caption">Gesti√≥n de Saldo</div>
                    </div>
                </div>
            </div>

            <div class="slide" data-code="code-webhooks">
                <div class="badge-tech">FINTECH INTEGRATION</div>
                <h2>Webhooks Orange Money</h2>
                <h3>Pagos As√≠ncronos</h3>
                <p>Gesti√≥n de confirmaciones externas mediante Endpoints seguros para evitar fraudes en el pago.</p>
                <div class="flow-diagram">
                    <div class="flow-node">App Orange</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node" style="border-color: #059669;">Callback API</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node">Verificar Firma</div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-node">Liberar Cr√©ditos</div>
                </div>
            </div>

            <!-- SECCI√ìN 8: EXPERIENCIA DEL MOTORISTA -->
            <div class="slide" data-code="code-moto-dash">
                <div class="badge-tech">DRIVER EXPERIENCE</div>
                <h2>Workspace del Motorista</h2>
                <h3>Productividad M√≥vil</h3>
                <p>Interfaz de alta velocidad dise√±ada para ser usada con una sola mano en movimiento.</p>
                <div class="img-container">
                    <img src="motorista_dashboard.png" alt="Dashboard Motorista">
                </div>
                <div class="explanation-box">
                    - Interruptor de disponibilidad "En L√≠nea".<br>
                    - Geolocalizaci√≥n persistente v√≠a <code>Navigator.geolocation</code>.<br>
                    - Alertas instant√°neas de nuevos viajes cercanos.
                </div>
            </div>

            <div class="slide" data-code="code-moto-hist">
                <div class="badge-tech">DRIVER EXPERIENCE</div>
                <h2>Control de Ingresos</h2>
                <h3>Transparencia y Crecimiento</h3>
                <div class="gallery-grid">
                    <div class="gallery-item">
                        <img src="motorista_historial.png" alt="Historial">
                        <div class="gallery-caption">Historial de Ganancias</div>
                    </div>
                    <div class="gallery-item">
                        <img src="motorista_perfil.png" alt="Perfil">
                        <div class="gallery-caption">Gesti√≥n de Veh√≠culo</div>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 9: ADMINISTRACI√ìN Y CONTROL -->
            <div class="slide" data-code="code-admin-dash">
                <div class="badge-tech">ADMIN CONTROL</div>
                <h2>Torre de Control</h2>
                <h3>Visibilidad Total 360¬∞</h3>
                <div class="img-container">
                    <img src="admin_dashboard.png" alt="Admin Dashboard">
                </div>
            </div>

            <div class="slide" data-code="code-admin-audit">
                <div class="badge-tech">ADMIN CONTROL</div>
                <h2>Auditor√≠a & Anti-Fraude</h2>
                <h3>Trazabilidad de Operaciones</h3>
                <p>Cada acci√≥n cr√≠tica (validaci√≥n de motorista, borrado de usuario) genera un rastro inmutable.</p>
                <div class="file-tree">
                    [2024-05-20 10:15] ADMIN_01 valid√≥ MOTORISTA_44<br>
                    [2024-05-20 11:30] SYSTEM detect√≥ RECARGA_FALLIDA via Orange Money
                </div>
                <div class="explanation-box">
                    Implementamos un sistema de <strong>Logs de Actividad</strong> que permite reconstruir cualquier
                    incidente financiero en cuesti√≥n de segundos.
                </div>
            </div>

            <div class="slide" data-code="code-admin-clients">
                <div class="badge-tech">ADMIN CONTROL</div>
                <h2>Gesti√≥n Granular</h2>
                <div class="gallery-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="gallery-item" style="height: 100px;"><img src="admin_motoristas.png">
                        <div class="gallery-caption">Motoristas</div>
                    </div>
                    <div class="gallery-item" style="height: 100px;"><img src="admin_clientes.png">
                        <div class="gallery-caption">Clientes</div>
                    </div>
                    <div class="gallery-item" style="height: 100px;"><img src="admin_viajes.png">
                        <div class="gallery-caption">Viajes</div>
                    </div>
                </div>
            </div>

            <div class="slide" data-code="code-secrets">
                <div class="badge-tech">DEVOPS & SECURITY</div>
                <h2>Variables de Entorno</h2>
                <h3>Secrets Management</h3>
                <p>Protecci√≥n total de credenciales sensibles mediante inyecci√≥n de <code>.env</code>.</p>
                <div class="file-tree">
                    JWT_SECRET=****************<br>
                    APP_KEY=base64:*************
                </div>
                <div class="explanation-box">
                    Separamos la configuraci√≥n del c√≥digo, permitiendo despliegues seguros en cualquier entorno (Dev,
                    Staging, Prod).
                </div>
            </div>

            <div class="slide" data-code="code-deploy">
                <div class="badge-tech">DEPLOYMENT</div>
                <h2>Despliegue y Acceso</h2>
                <h3>Exposici√≥n Segura Local</h3>
                <p>Nuestra infraestructura permite pruebas en dispositivos reales sin necesidad de un servidor remoto
                    costoso.</p>
                <div class="file-tree">
                    php artisan serve --host=0.0.0.0 --port=8000 <br>
                    .\cloudflared.exe tunnel --url http://localhost:8000
                </div>
                <div class="explanation-box">
                    <strong>Cloudflare Tunnels:</strong> Crea un puente seguro SSL entre tu m√°quina local y el mundo
                    exterior para demos en vivo.
                </div>
            </div>

            <div class="slide" data-code="code-qa-testing">
                <div class="badge-tech">QUALITY ASSURANCE</div>
                <h2>Pruebas y QA</h2>
                <h3>Validaci√≥n de Extremo a Extremo</h3>
                <p>MotoTX ha sido testeado bajo condiciones reales de red para asegurar su fiabilidad.</p>
                <div class="grid-tech">
                    <div class="tech-card">
                        <h4>Manual Testing</h4>
                        <p>Simulaci√≥n de viajes en dispositivos m√≥viles f√≠sicos.</p>
                    </div>
                    <div class="tech-card">
                        <h4>Edge Cases</h4>
                        <p>Manejo de p√©rdida de se√±al y reconexi√≥n autom√°tica.</p>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 10: INTERNACIONALIZACI√ìN -->
            <div class="slide" data-code="code-i18n">
                <div class="badge-tech">GLOBAL READY</div>
                <h2>Internacionalizaci√≥n (i18n)</h2>
                <h3>Soporte Multi-idioma Modular</h3>
                <p>La plataforma est√° dise√±ada para el mercado global, empezando por Bamako con soporte robusto de
                    idiomas.</p>
                <div class="grid-tech">
                    <div class="tech-card">
                        <h4>i18next Engine</h4>
                        <p>Gesti√≥n reactiva de diccionarios JSON (Espa√±ol, Franc√©s, Bambara).</p>
                    </div>
                    <div class="tech-card">
                        <h4>Localizaci√≥n Din√°mica</h4>
                        <p>Cambio de idioma instant√°neo sin recargar la aplicaci√≥n.</p>
                    </div>
                </div>
                <div class="explanation-box">
                    Utilizamos el hook <code>useTranslation</code> para asegurar que cada bot√≥n y alerta sea accesible y
                    comprensible para todos los usuarios.
                </div>
            </div>

            <!-- SECCI√ìN 11: CONCLUSI√ìN -->
            <div class="slide" data-code="">
                <h2>Conclusi√≥n y Futuro</h2>
                <h3>Escalabilidad e Impacto</h3>
                <div class="grid-tech">
                    <div class="tech-card">
                        <h4>Escalable</h4>
                        <p>Arquitectura lista para expandirse a nivel nacional.</p>
                    </div>
                    <div class="tech-card">
                        <h4>Innovador</h4>
                        <p>Primer sistema de forfaits digitales en el sector moto-taxi.</p>
                    </div>
                </div>
                <div style="text-align: center; width: 100%; margin-top: 40px;">
                    <h1 style="font-size: 3.5rem;">GRACIAS</h1>
                    <p style="margin: 0 auto;">¬øAlguna pregunta t√©cnica?</p>
                </div>
            </div>

            <div class="nav-controls">
                <button class="nav-btn" id="prevBtn" onclick="changeSlide(-1)">‚ùÆ</button>
                <span class="slide-indicator" id="slideIndicator">1 / 30</span>
                <button class="nav-btn" id="nextBtn" onclick="changeSlide(1)">‚ùØ</button>
                <button class="code-toggle" onclick="toggleCode()">Ver C√≥digo üëÅÔ∏è</button>
            </div>
        </div>

        <!-- PANEL DE C√ìDIGO -->
        <div class="code-panel" id="codePanel">
            <div class="code-header">
                <span id="fileName">Source.jsx</span>
                <span style="color: var(--text-dim); cursor: pointer;" onclick="toggleCode()">‚úñ</span>
            </div>
            <div class="code-content">
                <pre><code id="codeBlock" class="language-jsx"></code></pre>
            </div>
        </div>

    </div>

    <div class="lightbox-overlay" id="lightbox" onclick="closeLightbox()">
        <img src="" class="lightbox-img" id="lightboxImg">
    </div>

    <!-- DATA DE C√ìDIGO (FRAGMENTOS T√âCNICOS) -->
    <script type="text/plain" id="code-arch-global">
// üìÇ ESTRUCTURA DEL MONOREPO (Vite + Laravel)
// Este archivo define c√≥mo se orquestan los dos mundos: PHP y JS.
{
  "Backend": "Laravel 11 / PHP 8.2 - Gesti√≥n de APIs y l√≥gica pesada",
  "Frontend": "React 18 / Vite - Interfaz interactiva y reactiva",
  "Build": "npm run dev (Vite HMR) - Compilaci√≥n en milisegundos para desarrollo",
  "Integration": "resources/views/app.blade.php - El punto de entrada √∫nico"
}
    </script>

    <script type="text/plain" id="code-frontend-structure">
// üèóÔ∏è ESTRUCTURA ORGANIZACIONAL DEL FRONTEND
// resources/js/
// ‚îú‚îÄ‚îÄ components/      // Componentes UI Reutilizables (Card, Button, Badge)
// ‚îú‚îÄ‚îÄ context/         // Providers (AuthContext para persistencia de sesi√≥n)
// ‚îú‚îÄ‚îÄ hooks/           // Abstracci√≥n de l√≥gica (useGeolocation, useInterval)
// ‚îú‚îÄ‚îÄ pages/           // Vistas agrupadas por dominio (Cliente/, Motorista/, Admin/)
// ‚îî‚îÄ‚îÄ App.jsx          // Configuraci√≥n de React Router y Middlewares de UI
    </script>

    <script type="text/plain" id="code-service-layer">
// üß† PATR√ìN SERVICE LAYER (ViajeService.php)
// El "Service Layer" desacopla la l√≥gica de negocio de los controladores.
class ViajeService {
    /**
     * Procesa la solicitud de un nuevo viaje validando cr√©ditos y registros.
     */
    public function solicitarViaje(User $user, $coords) {
        // 1. Regla de Negocio: El cliente debe tener viajes disponibles en su forfait
        $clienteForfait = $this->getValidForfait($user->id);
        
        if (!$clienteForfait) {
             throw new \Exception('Sin viajes disponibles en el plan prepago.');
        }

        // 2. Transacci√≥n At√≥mica: O se crea el viaje y se descuenta el cr√©dito, o nada.
        // Esto garantiza la integridad financiera evitando "viajes gratis" por errores.
        return DB::transaction(function() use ($user, $coords, $clienteForfait) {
            $viaje = Viaje::create([
                'cliente_id' => $user->id,
                'estado' => 'solicitado', // Estado inicial del ciclo de vida
                ...$coords
            ]);
            
            // Reducimos el contador de viajes del cliente al instante
            $clienteForfait->decrement('viajes_restantes');
            return $viaje;
        });
    }
}
    </script>

    <script type="text/plain" id="code-auth">
// üîí SEGURIDAD: MIDDLEWARE JWT (routes/api.php)
// Utilizamos JSON Web Tokens para una autenticaci√≥n sin estado y segura.
Route::middleware('jwt.auth')->group(function () {
    // Estas rutas solo son accesibles si el cliente env√≠a un Token v√°lido en el Header.
    // Esto previene accesos no autorizados a la l√≥gica del negocio.
    Route::post('/viajes/solicitar', [ViajeController::class, 'solicitar']);
    Route::get('/perfil', [AuthController::class, 'profile']);
});

// AuthController.php - Procesa el inicio de sesi√≥n
public function login(Request $request) {
    $credentials = $request->only('email', 'password');
    // Intentamos autenticar; si falla, devolvemos 401 Unauthorized
    if (!$token = auth()->attempt($credentials)) {
        return response()->json(['error' => 'Credenciales inv√°lidas'], 401);
    }
    // Si tiene √©xito, devolvemos el Token que el Frontend guardar√° localmente
    return $this->respondWithToken($token);
}
    </script>

    <script type="text/plain" id="code-db-models">
// üì¶ MODELOS ELOQUENT (Viaje.php)
// Eloquent nos permite interactuar con la DB usando Programaci√≥n Orientada a Objetos.
class Viaje extends Model {
    protected $fillable = ['cliente_id', 'motorista_id', 'estado', 'costo'];

    // Relaci√≥n: Un viaje pertenece a un Cliente (User)
    public function cliente() {
        return $this->belongsTo(User::class, 'cliente_id');
    }

    // Relaci√≥n: Un viaje es realizado por un Motorista (User)
    public function motorista() {
        return $this->belongsTo(User::class, 'motorista_id');
    }

    // Relaci√≥n: Un viaje puede tener una calificaci√≥n al finalizar
    public function calificacion() {
        return $this->hasOne(Calificacion::class);
    }
}
    </script>

    <script type="text/plain" id="code-design-system">
/* üé® SISTEMA DE DISE√ëO AT√ìMICO (components.css) */
/* Centralizamos variables para garantizar consistencia visual en toda la App */
:root {
    --primary: #2563eb;    /* Azul corporativo */
    --success: #059669;    /* Verde para acciones positivas (Motoristas) */
    --accent: #facc15;     /* Amarillo para avisos o destacados */
    --radius: 1rem;        /* Bordes redondeados consistentes */
}

/* √Åtomo: mtx-card - Componente contenedor base reutilizable */
.mtx-card {
    background: white;
    border-radius: var(--radius);
    padding: 24px;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    transition: transform 0.2s ease; /* Efecto suave al interactuar */
}

/* Responsive: Adaptamos el layout sin necesidad de Media Queries pesadas en cada archivo */
@media (max-width: 768px) {
    .mtx-grid { grid-template-columns: 1fr; }
}
    </script>

    <script type="text/plain" id="code-landing">
// üåê COMPONENTE DE P√ÅGINA P√öBLICA (LandingPage.jsx)
// Arquitectura de componentes limpia y declarativa.
const LandingPage = () => {
    return (
        <main className="hero-section">
            <Navbar />
            <h1>Viaja seguro en Bamako</h1>
            {/* Llamada a la acci√≥n clara para captar usuarios */}
            <CTAButton to="/register" label="Empieza ahora" />
            <FeatureGrid items={features} />
            <Footer />
        </main>
    );
};
    </script>

    <script type="text/plain" id="code-register">
// üìù L√ìGICA DE REGISTRO DUAL
// Gestionamos varios roles en un solo componente reactivo.
const Register = () => {
    // El estado define si el usuario se registra como Cliente o Motorista
    const [role, setRole] = useState('cliente');
    
    return (
        <form onSubmit={handleRegister}>
            <RoleSwitcher active={role} onChange={setRole} />
            <Input name="name" label="Nombre Completo" />
            {/* Renderizado condicional: Solo motoristas ven el campo de licencia */}
            {role === 'motorista' && <Input name="license" label="N¬∫ Licencia" />}
            <button type="submit">Crear cuenta</button>
        </form>
    );
};
    </script>

    <script type="text/plain" id="code-client-dash">
// üìç DASHBOARD DEL CLIENTE (Geocodificaci√≥n con Nominatim)
// Convertimos direcciones textuales en coordenadas para el mapa.
const ClienteDashboard = () => {
    // B√∫squeda real de puntos de inter√©s en Bamako
    const handleSearch = async (address) => {
        const res = await axios.get(`.../search?q=${address}, Bamako`);
        if (res.data.length > 0) {
            const { lat, lon } = res.data[0];
            // Actualizamos marcadores y movemos la vista del mapa
            setOrigen([parseFloat(lat), parseFloat(lon)]);
        }
    };

    return (
        <div className="side-panel">
            {/* Input reactivo con b√∫squeda por tecla Enter o Lupa */}
            <input 
                placeholder="Busca una calle..."
                onKeyDown={e => e.key === 'Enter' && handleSearch(val)} 
            />
            <MapSelection origen={origen} destino={destino} />
        </div>
    );
};
    </script>

    <script type="text/plain" id="code-smart-mobility">
// üõ°Ô∏è VALIDACI√ìN DE DISTANCIA (Smart Mobility)
// Comparamos el trayecto planificado con el l√≠mite del Forfait.
useEffect(() => {
    if (origen && destino) {
        const metrics = getMetrics(origen, destino);
        // maxDistance se hereda del Forfait activo del usuario
        if (maxDistance > 0 && metrics.distance > maxDistance) {
            setDistanciaExcedida(true); // Bloquea el bot√≥n de solicitud
        }
    }
}, [origen, destino, maxDistance]);
    </script>

    <script type="text/plain" id="code-client-forfaits">
// üí≥ FLUJO DE COMPRA DE FORFAITS
// Integraci√≥n con el backend para la activaci√≥n de planes prepago.
const purchaseForfait = async (id) => {
    // Iniciamos la transacci√≥n en el servidor
    const res = await api.post('/api/pay/init', { forfait_id: id });
    if (res.data.status === 'success') {
        // Mostramos confirmaci√≥n visual al usuario
        Swal.fire('¬°√âxito!', 'Forfait activado correctamente', 'success');
        // Actualizamos el saldo en la interfaz de forma reactiva
        updateUserBalance();
    }
};
    </script>

    <script type="text/plain" id="code-moto-dash">
// üèçÔ∏è SEGUIMIENTO EN TIEMPO REAL DEL MOTORISTA
// Utilizamos la API nativa de Geolocation para alta precisi√≥n.
useEffect(() => {
    // Observamos el movimiento del dispositivo de forma persistente
    const watcher = navigator.geolocation.watchPosition(pos => {
        if (isOnline) {
            // Enviamos las coordenadas al servidor solo si el motorista est√° "En L√≠nea"
            updateLiveLocation({
                lat: pos.coords.latitude,
                lng: pos.coords.longitude
            });
        }
    });
    // Limpiamos el observador al desmontar el componente para ahorrar bater√≠a
    return () => navigator.geolocation.clearWatch(watcher);
}, [isOnline]);
    </script>

    <script type="text/plain" id="code-moto-hist">
// üí∞ L√ìGICA DE GANANCIAS DEL MOTORISTA (MotoristaHistory.jsx)
// Calculamos estad√≠sticas en tiempo real usando useMemo para optimizar el rendimiento.
const stats = useMemo(() => {
    return trips.reduce((acc, trip) => {
        // Acumulamos el costo total de los viajes finalizados
        acc.total += trip.costo;
        // Contamos el n√∫mero de servicios realizados
        acc.count += 1;
        return acc;
    }, { total: 0, count: 0 });
}, [trips]); // Solo se recalcula si la lista de viajes cambia
    </script>

    <script type="text/plain" id="code-i18n">
// üåç INTERNACIONALIZACI√ìN (i18next)
// Diccionarios modulares para una experiencia local.
{
  "client_dashboard": {
    "trip_details": "Detalles del Trayecto",
    "limit_exceeded": "L√≠mite Excedido",
    "need_premium_pack": "Este trayecto supera los KM de tu paquete..."
  }
}
    </script>

    <script type="text/plain" id="code-admin-dash">
// üìä AGREGACI√ìN DE KPIs ADMINISTRATIVOS (AdminController.php)
// Punto central para monitorear la salud econ√≥mica y operativa de MotoTX.
public function getStats() {
    return [
        // C√°lculo en tiempo real de viajes que est√°n ocurriendo ahora mismo
        'active_trips' => Viaje::where('estado', 'en_curso')->count(),
        // Sumatoria hist√≥rica de ingresos para reportes financieros
        'total_revenue' => Viaje::sum('costo'),
        // Tasa de adopci√≥n: Total de usuarios registrados en la plataforma
        'users_count' => User::count()
    ];
}
    </script>

    <script type="text/plain" id="code-admin-clients">
// üë• GESTI√ìN DE USUARIOS (Panel de Administraci√≥n)
// L√≥gica para el mantenimiento y depuraci√≥n de la base de usuarios.
const AdminUsers = () => {
    const deleteUser = async (id) => {
        // Validaci√≥n de doble paso para evitar borrados accidentales
        if (window.confirm('¬øEst√° seguro de eliminar definitivamente a este usuario?')) {
            await axios.delete(`/api/admin/users/${id}`);
            // Refrescamos la lista local tras la eliminaci√≥n exitosa
            fetchUsers();
        }
    };
    return <Table data={users} onDelete={deleteUser} />;
};
    </script>

    <script type="text/plain" id="code-deploy">
# üöÄ DEPLOYMENT CONFIG (Local Tunnel)
# 1. Start Server
php artisan serve --host=0.0.0.0

# 2. Expose with Cloudflare
./cloudflared tunnel --url http://localhost:8000

# 3. Update .env APP_URL to tunnel address
# APP_URL=https://moto-tx-demo.trycloudflare.com
    </script>

    <!-- NUEVOS FRAGMENTOS T√âCNICOS (Capa 4) -->
    <script type="text/plain" id="code-frontend-context">
// ‚öõÔ∏è CONTEXTO DE AUTENTICACI√ìN (AuthContext.jsx)
// Proveedor global para gestionar el estado del usuario en toda la App.
export const AuthProvider = ({ children }) => {
    const [user, setUser] = useState(null);
    const [token, setToken] = useState(localStorage.getItem('token'));

    useEffect(() => {
        if (token) {
            // Configuramos el header de Axios para que todas las peticiones lleven el Token
            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
            fetchUser(); // Recuperamos datos del usuario autenticado
        }
    }, [token]);

    return (
        <AuthContext.Provider value={{ user, token, setToken }}>
            {children}
        </AuthContext.Provider>
    );
};
    </script>

    <script type="text/plain" id="code-frontend-hooks">
// üé£ CUSTOM HOOK: useGeolocation.js
// Abstraemos la API de geolocalizaci√≥n para reutilizarla en cualquier componente.
export const useGeolocation = () => {
    const [coords, setCoords] = useState(null);

    useEffect(() => {
        // Iniciamos el seguimiento de la posici√≥n con alta precisi√≥n
        const id = navigator.geolocation.watchPosition(
            pos => setCoords({ lat: pos.coords.latitude, lng: pos.coords.longitude }),
            err => console.error(err),
            { enableHighAccuracy: true }
        );
        // Funci√≥n de limpieza para detener el GPS al salir de la vista
        return () => navigator.geolocation.clearWatch(id);
    }, []);

    return coords;
};
    </script>

    <script type="text/plain" id="code-api-rest">
// üåê RESPUESTAS API CONSISTENTES (BaseController.php)
// Estandarizamos la salida de la API para facilitar el consumo desde React.
public function sendResponse($result, $message, $code = 200) {
    $response = [
        'status' => 'success', // Indicador de √©xito
        'data'    => $result,   // Cuerpo de los datos JSON
        'message' => $message,  // Mensaje informativo
    ];
    return response()->json($response, $code);
}

public function sendError($error, $errorMessages = [], $code = 404) {
    $response = [
        'status' => 'error',    // Indicador de fallo
        'message' => $error,
    ];
    // Enviamos detalles adicionales de validaci√≥n si existen
    if(!empty($errorMessages)) { $response['data'] = $errorMessages; }
    return response()->json($response, $code);
}
    </script>

    <script type="text/plain" id="code-frontend-routes">
// üõ°Ô∏è PROTECTED ROUTES (App.jsx)
const ProtectedRoute = ({ children, allowedRole }) => {
    const { user, token } = useAuth();
    
    if (!token) return <Navigate to="/login" />;
    
    if (allowedRole && user?.role !== allowedRole) {
        return <Navigate to="/unauthorized" />;
    }
    
    return children;
};
    </script>

    <script type="text/plain" id="code-performance">
// ‚ö° OPTIMIZACI√ìN VITE (vite.config.js)
// Configuramos el empaquetador para maximizar la velocidad en m√≥viles.
export default defineConfig({
  plugins: [react()],
  build: {
    rollupOptions: {
      output: {
        // Separamos librer√≠as pesadas en chunks independientes para cargar solo lo necesario
        manualChunks: {
          vendor: ['react', 'react-dom', 'leaflet'],
          ui: ['@headlessui/react', '@heroicons/react']
        }
      }
    },
    chunkSizeWarningLimit: 500, // Alertamos si un archivo crece demasiado
    minify: 'terser' // Minificaci√≥n agresiva para ahorrar cada KB en redes 3G
  }
});
    </script>

    <script type="text/plain" id="code-ux-psych">
/* üß† PSICOLOG√çA UX APLICADA (components.css) */
/* Bot√≥n de acci√≥n principal del motorista optimizado para el uso real */
.btn-motorista-main {
    height: 80px; /* √Årea t√°ctil ampliada: Evita errores al conducir */
    font-size: 1.2rem;
    font-weight: 800;
    text-transform: uppercase;
    /* Sombra profunda para dar sensaci√≥n de profundidad y facilidad de clic */
    box-shadow: 0 10px 20px rgba(5, 150, 105, 0.3);
}

.card-interactive:active {
    transform: scale(0.98); /* Feedback de "pulsaci√≥n" inmediata al usuario */
}
    </script>

    <script type="text/plain" id="code-algorithm">
// üìê ALGORITMO DE PAGO DE VIAJE (ForfaitService.php)
// Procesa la transferencia de valor entre cliente y motorista.
public function processTripPayment(User $client, User $driver) {
    return DB::transaction(function() use ($client, $driver) {
        $forfait = $client->activeForfait;
        
        // Verificaci√≥n de integridad: Evitamos pagos sin saldo
        if ($forfait->viajes_restantes <= 0) {
            throw new InsufficientCreditException();
        }

        // 1. Descontamos el viaje del paquete prepago del cliente
        $forfait->decrement('viajes_restantes');
        
        // 2. Acreditamos el valor correspondiente en la billetera del motorista
        // Este valor es din√°mico seg√∫n el tipo de Forfait adquirido
        $driver->wallet->increment('earnings', $forfait->per_trip_value);
        
        return true;
    });
}
    </script>

    <script type="text/plain" id="code-webhooks">
// üîî GESTI√ìN DE WEBHOOKS (OrangeMoneyController.php)
// Procesamos pagos as√≠ncronos desde plataformas externas de forma segura.
public function handleWebhook(Request $request) {
    // 1. Verificaci√≥n de Seguridad: Comprobamos la firma digital del mensaje
    $signature = $request->header('X-OM-Signature');
    
    if (!$this->verifySignature($request->all(), $signature)) {
        return response('Firma inv√°lida - No autorizado', 403);
    }

    // 2. Procesamiento: Identificamos la transacci√≥n en nuestra base de datos
    $transaction = Transaction::where('ref', $request->order_id)->first();
    $transaction->update(['status' => 'completed']);
    
    // 3. Activaci√≥n: Liberamos los cr√©ditos al cliente de forma instant√°nea
    $this->creditClientForfait($transaction->user_id, $transaction->amount);
    
    return response('Recibido con √©xito', 200);
}
    </script>

    <script type="text/plain" id="code-admin-audit">
// üïµÔ∏è REGISTRO DE AUDITOR√çA (AuditMiddleware.php)
// Monitorizamos acciones administrativas para prevenir fraudes.
public function handle($request, Closure $next) {
    $response = $next($request);

    // Solo registramos operaciones que modifican datos (POST, DELETE)
    if ($request->isMethod('post') || $request->isMethod('delete')) {
        AuditLog::create([
            'user_id' => auth()->id(),
            'action' => $request->path(),
            'payload' => json_encode($request->except('password')), // Seguridad: Ocultamos claves
            'ip' => $request->ip()
        ]);
    }

    return $response;
}
    </script>

    <script type="text/plain" id="code-secrets">
# üóùÔ∏è ARQUITECTURA DE SECRETOS (.env.example)
# Las claves sensibles NO se almacenan en el c√≥digo fuente.
DB_PASSWORD=${PROD_DB_PASSWORD}  # Inyectado por el entorno de producci√≥n
JWT_SECRET=${JWT_SIGNING_KEY}    # Protegido en la "Vault" de Railway
ORANGE_MONEY_KEY=${OM_SECRET_SANDBOX}

# Esto garantiza que si el c√≥digo se filtra, las llaves sigan seguras.
    </script>

    <script type="text/plain" id="code-qa-testing">
// üß™ PRUEBAS UNITARIAS Y DE FLUJO (TripFlow.test.js)
// Aseguramos la fiabilidad de las reglas de negocio cr√≠ticas.
test('El cliente no puede solicitar viaje sin saldo', async () => {
    // Simulamos un usuario con cr√©dito cero
    const user = userFactory({ credits: 0 });
    const response = await api.post('/viajes/solicitar', {
        origin: [12.6, -7.9],
        dest: [12.65, -8.0]
    });
    
    // El servidor debe responder con 422 Unprocessable Content (Error de Validaci√≥n)
    expect(response.status).toBe(422);
    // Verificamos que el mensaje de error sea claro para el usuario final
    expect(response.data.message).toMatch(/cr√©dito insuficiente/i);
});
    </script>

    <!-- SCRIPTS DE INTERACCI√ìN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const slideIndicator = document.getElementById('slideIndicator');
        const codePanel = document.getElementById('codePanel');
        const codeBlock = document.getElementById('codeBlock');
        const fileNameDisp = document.getElementById('fileName');

        function changeSlide(n) {
            slides[currentSlide].classList.remove('active');
            currentSlide = (currentSlide + n + slides.length) % slides.length;
            slides[currentSlide].classList.add('active');

            updateNavigation();
            updateCodeView();
        }

        function updateNavigation() {
            slideIndicator.innerText = `${currentSlide + 1} / ${slides.length}`;
            document.getElementById('prevBtn').disabled = currentSlide === 0;
            document.getElementById('nextBtn').disabled = currentSlide === slides.length - 1;
        }

        function updateCodeView() {
            const slide = slides[currentSlide];
            const codeKey = slide.getAttribute('data-code');

            if (codeKey && document.getElementById(codeKey)) {
                codeBlock.innerText = document.getElementById(codeKey).innerText.trim();
                fileNameDisp.innerText = getFileTag(codeKey);
                Prism.highlightElement(codeBlock);
                codePanel.classList.add('active');
            } else {
                codePanel.classList.remove('active');
            }
        }

        function getFileTag(key) {
            const map = {
                'code-arch-global': 'architecture.json',
                'code-frontend-structure': 'folder-tree-layout',
                'code-service-layer': 'ViajeService.php',
                'code-api-rest': 'BaseController.php',
                'code-auth': 'api.php | AuthController.php',
                'code-frontend-routes': 'App.jsx (Security)',
                'code-db-models': 'Viaje.php (Model)',
                'code-algorithm': 'ForfaitService.php',
                'code-design-system': 'components.css',
                'code-performance': 'vite.config.js',
                'code-ux-psych': 'psychology.css',
                'code-frontend-context': 'AuthContext.jsx',
                'code-frontend-hooks': 'useGeolocation.js',
                'code-landing': 'LandingPage.jsx',
                'code-register': 'Register.jsx',
                'code-client-dash': 'ClienteDashboard.jsx',
                'code-smart-mobility': 'RangeValidator.js',
                'code-i18n': 'es.json',
                'code-client-forfaits': 'ForfaitService.js',
                'code-webhooks': 'OrangeMoneyController.php',
                'code-moto-dash': 'MotoristaDashboard.jsx',
                'code-moto-hist': 'MotoristaHistory.jsx',
                'code-admin-dash': 'AdminController.php',
                'code-admin-audit': 'AuditMiddleware.php',
                'code-admin-clients': 'AdminUsers.jsx',
                'code-secrets': '.env (Vault Injection)',
                'code-deploy': 'deploy.sh',
                'code-qa-testing': 'TripFlow.test.js'
            };
            return map[key] || 'Source.jsx';
        }

        function toggleCode() {
            codePanel.classList.toggle('active');
        }

        // LIGHTBOX LOGIC
        function openLightbox(src) {
            const lb = document.getElementById('lightbox');
            const img = document.getElementById('lightboxImg');
            img.src = src;
            lb.classList.add('active');
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
        }

        // Attach click listeners to images
        document.querySelectorAll('img').forEach(img => {
            img.style.cursor = 'zoom-in';
            img.addEventListener('click', () => openLightbox(img.src));
        });

        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') changeSlide(1);
            if (e.key === 'ArrowLeft') changeSlide(-1);
            if (e.key === 'c' || e.key === 'C') toggleCode();
            if (e.key === 'Escape') closeLightbox();
        });

        // Initialize view
        updateNavigation();
        updateCodeView();
    </script>
</body>

</html>